{"version":3,"file":"getData.js","names":["dropEmptyRows","dropEmptyColumns","getData","sheet","options","dimensions","cells","length","leftTop","rightBottom","colsCount","column","rowsCount","row","data","Array","i","j","cell","rowIndex","columnIndex","value","rowMap","onlyTrimAtTheEnd","transformData"],"sources":["../../source/read/getData.js"],"sourcesContent":["import dropEmptyRows from './dropEmptyRows.js'\r\nimport dropEmptyColumns from './dropEmptyColumns.js'\r\n\r\nexport default function getData(sheet, options) {\r\n  const { dimensions, cells } = sheet\r\n\r\n  // If the sheet is empty.\r\n  if (cells.length === 0) {\r\n    return []\r\n  }\r\n\r\n  const [leftTop, rightBottom] = dimensions\r\n\r\n  // Don't discard empty rows or columns at the start.\r\n  // https://github.com/catamphetamine/read-excel-file/issues/102\r\n  // const colsCount = (rightBottom.column - leftTop.column) + 1\r\n  // const rowsCount = (rightBottom.row - leftTop.row) + 1\r\n\r\n  const colsCount = rightBottom.column\r\n  const rowsCount = rightBottom.row\r\n\r\n  // Initialize spreadsheet data structure.\r\n  let data = new Array(rowsCount)\r\n  let i = 0\r\n  while (i < rowsCount) {\r\n    data[i] = new Array(colsCount)\r\n    let j = 0\r\n    while (j < colsCount) {\r\n      data[i][j] = null\r\n      j++\r\n    }\r\n    i++\r\n  }\r\n\r\n  // Fill in spreadsheet `data`.\r\n  // (this code implies that `cells` aren't necessarily sorted by row and column:\r\n  //  maybe that's not correct, this piece code was initially copy-pasted\r\n  //  from some other library that used `XPath`)\r\n  for (const cell of cells) {\r\n    // Don't discard empty rows or columns at the start.\r\n    // https://github.com/catamphetamine/read-excel-file/issues/102\r\n    // const rowIndex = cell.row - leftTop.row\r\n    // const columnIndex = cell.column - leftTop.column\r\n    const rowIndex = cell.row - 1\r\n    const columnIndex = cell.column - 1\r\n    // Ignore the data in the cell if it's outside of the spreadsheet's \"dimensions\".\r\n    if (columnIndex < colsCount && rowIndex < rowsCount) {\r\n      data[rowIndex][columnIndex] = cell.value\r\n    }\r\n  }\r\n\r\n  // Fill in the row map.\r\n  const { rowMap } = options\r\n  if (rowMap) {\r\n    let i = 0\r\n    while (i < data.length) {\r\n      rowMap[i] = i\r\n      i++\r\n    }\r\n  }\r\n\r\n  // Drop empty columns or rows.\r\n  data = dropEmptyRows(\r\n    dropEmptyColumns(data, { onlyTrimAtTheEnd: true }),\r\n    { onlyTrimAtTheEnd: true, rowMap }\r\n  )\r\n\r\n  // Optionally transform data before applying `schema`.\r\n  if (options.transformData) {\r\n    data = options.transformData(data)\r\n    // data = options.transformData(data, {\r\n    //   dropEmptyRowsAndColumns(data) {\r\n    //     return dropEmptyRows(dropEmptyColumns(data), { rowMap })\r\n    //   }\r\n    // })\r\n  }\r\n\r\n  return data\r\n}"],"mappings":";;;;;;;;;;;;;;AAAA,OAAOA,aAAP,MAA0B,oBAA1B;AACA,OAAOC,gBAAP,MAA6B,uBAA7B;AAEA,eAAe,SAASC,OAAT,CAAiBC,KAAjB,EAAwBC,OAAxB,EAAiC;EAC9C,IAAQC,UAAR,GAA8BF,KAA9B,CAAQE,UAAR;EAAA,IAAoBC,KAApB,GAA8BH,KAA9B,CAAoBG,KAApB,CAD8C,CAG9C;;EACA,IAAIA,KAAK,CAACC,MAAN,KAAiB,CAArB,EAAwB;IACtB,OAAO,EAAP;EACD;;EAED,iCAA+BF,UAA/B;EAAA,IAAOG,OAAP;EAAA,IAAgBC,WAAhB,kBAR8C,CAU9C;EACA;EACA;EACA;;;EAEA,IAAMC,SAAS,GAAGD,WAAW,CAACE,MAA9B;EACA,IAAMC,SAAS,GAAGH,WAAW,CAACI,GAA9B,CAhB8C,CAkB9C;;EACA,IAAIC,IAAI,GAAG,IAAIC,KAAJ,CAAUH,SAAV,CAAX;EACA,IAAII,CAAC,GAAG,CAAR;;EACA,OAAOA,CAAC,GAAGJ,SAAX,EAAsB;IACpBE,IAAI,CAACE,CAAD,CAAJ,GAAU,IAAID,KAAJ,CAAUL,SAAV,CAAV;IACA,IAAIO,CAAC,GAAG,CAAR;;IACA,OAAOA,CAAC,GAAGP,SAAX,EAAsB;MACpBI,IAAI,CAACE,CAAD,CAAJ,CAAQC,CAAR,IAAa,IAAb;MACAA,CAAC;IACF;;IACDD,CAAC;EACF,CA7B6C,CA+B9C;EACA;EACA;EACA;;;EACA,qDAAmBV,KAAnB,wCAA0B;IAAA,IAAfY,IAAe;IACxB;IACA;IACA;IACA;IACA,IAAMC,QAAQ,GAAGD,IAAI,CAACL,GAAL,GAAW,CAA5B;IACA,IAAMO,WAAW,GAAGF,IAAI,CAACP,MAAL,GAAc,CAAlC,CANwB,CAOxB;;IACA,IAAIS,WAAW,GAAGV,SAAd,IAA2BS,QAAQ,GAAGP,SAA1C,EAAqD;MACnDE,IAAI,CAACK,QAAD,CAAJ,CAAeC,WAAf,IAA8BF,IAAI,CAACG,KAAnC;IACD;EACF,CA9C6C,CAgD9C;;;EACA,IAAQC,MAAR,GAAmBlB,OAAnB,CAAQkB,MAAR;;EACA,IAAIA,MAAJ,EAAY;IACV,IAAIN,GAAC,GAAG,CAAR;;IACA,OAAOA,GAAC,GAAGF,IAAI,CAACP,MAAhB,EAAwB;MACtBe,MAAM,CAACN,GAAD,CAAN,GAAYA,GAAZ;MACAA,GAAC;IACF;EACF,CAxD6C,CA0D9C;;;EACAF,IAAI,GAAGd,aAAa,CAClBC,gBAAgB,CAACa,IAAD,EAAO;IAAES,gBAAgB,EAAE;EAApB,CAAP,CADE,EAElB;IAAEA,gBAAgB,EAAE,IAApB;IAA0BD,MAAM,EAANA;EAA1B,CAFkB,CAApB,CA3D8C,CAgE9C;;EACA,IAAIlB,OAAO,CAACoB,aAAZ,EAA2B;IACzBV,IAAI,GAAGV,OAAO,CAACoB,aAAR,CAAsBV,IAAtB,CAAP,CADyB,CAEzB;IACA;IACA;IACA;IACA;EACD;;EAED,OAAOA,IAAP;AACD"}